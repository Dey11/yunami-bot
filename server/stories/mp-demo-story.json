{
  "id": "mp-demo-story",
  "title": "The Heist",
  "description": "A multiplayer heist story demonstrating shared voting, arc splits, DMs, and reunions.",
  "min_party_size": 2,
  "max_party_size": 4,
  "supports_solo": false,
  "firstNodeId": "intro",
  "nodes": {
    "intro": {
      "id": "intro",
      "schema_version": 1,
      "type": "narrative",
      "title": "The Briefing",
      "tags": ["intro", "all-players"],
      "public_embed": {
        "title": "üèõÔ∏è The Vault Job",
        "description": "Your crew gathers in the dimly lit warehouse. The target: First National Bank's underground vault.\n\n**Mission Objective:** Secure the contents of Safety Deposit Box #742.\n\nThe mastermind spreads blueprints across the table.",
        "image": "Background.png",
        "footer": "All players present",
        "fields": [
          { "name": "Intel", "value": "Security rotates every 30 minutes. You have a narrow window." }
        ]
      },
      "type_specific": {
        "extra_data": {
          "nextNodeId": "team_vote"
        }
      },
      "preconditions": {
        "min_player_count": 2
      }
    },

    "team_vote": {
      "id": "team_vote",
      "schema_version": 1,
      "type": "timed",
      "title": "Entry Strategy",
      "tags": ["shared", "vote", "all-players"],
      "public_embed": {
        "title": "üó≥Ô∏è Choose Your Entry Point",
        "description": "The crew must decide how to enter the bank. Vote now!",
        "image": "Background.png",
        "footer": "Vote as a team! | Timer active",
        "fields": [
          { "name": "üö™ Front Door", "value": "Bold. Walk in during closing hours disguised as cleaning staff." },
          { "name": "üï≥Ô∏è Underground", "value": "Risky. Tunnel through the old subway maintenance shaft." }
        ]
      },
      "type_specific": {
        "timers": {
          "duration_seconds": 45
        },
        "choices": [
          {
            "id": "front_door",
            "label": "Front Door Approach",
            "nextNodeId": "entry_front"
          },
          {
            "id": "underground",
            "label": "Underground Tunnel",
            "nextNodeId": "entry_tunnel"
          }
        ],
        "outcome_rules": {
          "on_all_inputs_or_timeout": {
            "compute": "majority"
          }
        }
      },
      "preconditions": {
        "min_player_count": 2
      }
    },

    "entry_front": {
      "id": "entry_front",
      "schema_version": 1,
      "type": "narrative",
      "title": "Through the Front",
      "tags": ["shared", "all-players"],
      "public_embed": {
        "title": "üö™ Entering Through the Front",
        "description": "Dressed as cleaning staff, you walk past the security desk. The guard barely glances up from his phone.\n\nYou're in. But now the team must split up.",
        "image": "Background.png",
        "footer": "All players"
      },
      "type_specific": {
        "extra_data": {
          "nextNodeId": "group_splits"
        }
      }
    },

    "entry_tunnel": {
      "id": "entry_tunnel",
      "schema_version": 1,
      "type": "narrative",
      "title": "The Tunnel",
      "tags": ["shared", "all-players"],
      "public_embed": {
        "title": "üï≥Ô∏è Through the Tunnels",
        "description": "You crawl through the dark maintenance shaft. Rats scatter as your flashlight sweeps the walls.\n\nYou emerge in the bank's basement. Time to split up.",
        "image": "Background.png",
        "footer": "All players"
      },
      "type_specific": {
        "extra_data": {
          "nextNodeId": "group_splits"
        }
      }
    },

    "group_splits": {
      "id": "group_splits",
      "schema_version": 1,
      "type": "arc_split",
      "title": "The Split",
      "tags": ["arc-split"],
      "public_embed": {
        "title": "‚ö° Time to Split Up",
        "description": "The vault is on the lower level, but security cameras need to be disabled from the control room.\n\nThe **Scout** will sneak to the control room and receive private intel.\nThe **Main Team** will proceed to the vault entrance.",
        "image": "Background.png",
        "footer": "Teams will separate",
        "fields": [
          { "name": "üîç Scout Mission", "value": "Disable cameras. You'll receive a secret DM." },
          { "name": "üõ°Ô∏è Main Team", "value": "Proceed to the vault. Work together." }
        ]
      },
      "type_specific": {
        "arc_split": {
          "split_mode": "role_based",
          "merge_node_id": "reunion",
          "arcs": [
            {
              "id": "solo_scout",
              "label": "Scout Mission",
              "description": "Disable cameras and receive secret intel",
              "player_count": 1,
              "entry_node_id": "scout_dm",
              "required_roles": ["scout"]
            },
            {
              "id": "main_team",
              "label": "Main Team",
              "description": "Proceed to the vault",
              "player_count": "remaining",
              "entry_node_id": "team_vault"
            }
          ]
        }
      },
      "preconditions": {
        "min_player_count": 2
      }
    },

    "scout_dm": {
      "id": "scout_dm",
      "schema_version": 1,
      "type": "dm",
      "title": "Secret Intel",
      "tags": ["solo-arc", "scout", "private"],
      "public_embed": {
        "title": "üì© Intercepted Transmission",
        "description": "You tap into the security feed and discover something unexpected...\n\n**The vault contains more than just the deposit box.** There's a hidden compartment behind the main safe.\n\nThis information is yours alone. Use it wisely when you reunite with the team.",
        "image": "Background.png",
        "footer": "Private Intel | Scout Only",
        "fields": [
          { "name": "üîê Secret Code", "value": "The hidden compartment code is **7-4-2-9**" }
        ]
      },
      "side_effects_on_enter": {
        "spawn_dm_jobs": true
      },
      "type_specific": {
        "arc_context": {
          "arc_id": "solo_scout"
        },
        "dm_deliveries": [
          {
            "recipient_role": "scout",
            "content": {
              "text": "üîê **SECRET INTEL** üîê\n\nYou intercepted a transmission!\n\n**The hidden compartment code is: 7-4-2-9**\n\nThis information is yours alone. Share it with your team when you reunite."
            }
          }
        ],
        "extra_data": {
          "nextNodeId": "scout_disable"
        }
      },
      "preconditions": {
        "required_arc": "solo_scout"
      }
    },

    "scout_disable": {
      "id": "scout_disable",
      "schema_version": 1,
      "type": "choice",
      "title": "Control Room",
      "tags": ["solo-arc", "scout"],
      "public_embed": {
        "title": "üìπ Camera Control Room",
        "description": "You've reached the control room. A guard is asleep at the desk.\n\nHow do you proceed?",
        "image": "Background.png",
        "footer": "Solo Arc | Scout"
      },
      "type_specific": {
        "arc_context": {
          "arc_id": "solo_scout"
        },
        "choices": [
          {
            "id": "disable_silent",
            "label": "Silently disable cameras",
            "ephemeral_confirmation": true,
            "nextNodeId": "scout_success"
          },
          {
            "id": "disable_loud",
            "label": "Knock out the guard first",
            "ephemeral_confirmation": true,
            "nextNodeId": "scout_success"
          }
        ]
      },
      "preconditions": {
        "required_arc": "solo_scout"
      }
    },

    "scout_success": {
      "id": "scout_success",
      "schema_version": 1,
      "type": "narrative",
      "title": "Cameras Down",
      "tags": ["solo-arc", "scout"],
      "public_embed": {
        "title": "‚úÖ Cameras Disabled",
        "description": "The security feeds go dark. You've bought the team valuable time.\n\nTime to rendezvous.",
        "image": "Background.png",
        "footer": "Solo Arc Complete"
      },
      "type_specific": {
        "arc_context": {
          "arc_id": "solo_scout"
        },
        "extra_data": {
          "nextNodeId": "reunion"
        }
      },
      "preconditions": {
        "required_arc": "solo_scout"
      }
    },

    "team_vault": {
      "id": "team_vault",
      "schema_version": 1,
      "type": "timed",
      "title": "Vault Approach",
      "tags": ["group-arc", "main-team", "vote"],
      "public_embed": {
        "title": "üîí The Vault Door",
        "description": "You reach the vault. The door is massive, reinforced steel.\n\nHow does the team proceed?",
        "image": "Background.png",
        "footer": "Group Arc | Vote together",
        "fields": [
          { "name": "üí£ Explosives", "value": "Fast but loud. Might trigger alarms." },
          { "name": "üîß Safecracker", "value": "Slow but silent. Requires patience." }
        ]
      },
      "type_specific": {
        "arc_context": {
          "arc_id": "main_team"
        },
        "timers": {
          "duration_seconds": 30
        },
        "choices": [
          {
            "id": "explosives",
            "label": "Use Explosives",
            "nextNodeId": "team_vault_open"
          },
          {
            "id": "safecracker",
            "label": "Safecracker Method",
            "nextNodeId": "team_vault_open"
          }
        ],
        "outcome_rules": {
          "on_all_inputs_or_timeout": {
            "compute": "majority"
          }
        }
      },
      "preconditions": {
        "required_arc": "main_team"
      }
    },

    "team_vault_open": {
      "id": "team_vault_open",
      "schema_version": 1,
      "type": "narrative",
      "title": "Vault Open",
      "tags": ["group-arc", "main-team"],
      "public_embed": {
        "title": "üö™ The Vault Opens",
        "description": "The heavy door swings open, revealing rows of safety deposit boxes.\n\nYou locate Box #742. Inside is a flash drive labeled 'CLASSIFIED'.\n\nTime to meet up with the scout.",
        "image": "Background.png",
        "footer": "Group Arc Complete"
      },
      "type_specific": {
        "arc_context": {
          "arc_id": "main_team"
        },
        "extra_data": {
          "nextNodeId": "reunion"
        }
      },
      "preconditions": {
        "required_arc": "main_team"
      }
    },

    "reunion": {
      "id": "reunion",
      "schema_version": 1,
      "type": "arc_merge",
      "title": "The Rendezvous",
      "tags": ["arc-merge", "all-players"],
      "public_embed": {
        "title": "ü§ù Team Reunited",
        "description": "The team regroups in the basement corridor.\n\nThe scout shares intel about a hidden compartment. The main team shows the flash drive from Box #742.\n\n**Together, you have everything you need.**",
        "image": "Background.png",
        "footer": "All players together",
        "fields": [
          { "name": "üì¶ Loot", "value": "Flash drive + Knowledge of hidden compartment" }
        ]
      },
      "type_specific": {
        "extra_data": {
          "nextNodeId": "finale"
        }
      }
    },

    "finale": {
      "id": "finale",
      "schema_version": 1,
      "type": "narrative",
      "title": "The Escape",
      "tags": ["ending", "all-players"],
      "public_embed": {
        "title": "üöó Clean Getaway",
        "description": "Sirens wail in the distance, but you're already blocks away.\n\nThe heist was a success. The flash drive contains evidence that will bring down a corrupt politician.\n\n**Mission Complete.**\n\n*The Heist Demo Complete!*",
        "image": "Background.png",
        "footer": "Story complete"
      }
    }
  }
}
